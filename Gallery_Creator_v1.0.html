<!DOCTYPE html>
<html lang="he">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="gallery.png" type="image/png" />
    <link rel="apple-touch-icon" href="gallery.png" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>יוצר גלריות</title>
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        font-family: "Rubik", sans-serif;
        background: linear-gradient(135deg, #5100ff 0%, #2e9cfc 100%);
        margin: 0;
        padding: 20px;
        touch-action: manipulation;
        min-height: 100vh;
      }

      #gallery-form {
        background-color: rgba(255, 255, 255, 0.9);
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        max-width: 600px;
        width: 100%;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        gap: 15px;
        direction: rtl;
      }

      #gallery-form h1 {
        color: #00308a;
        text-align: center;
        margin: 0 0 15px 0;
      }

      #gallery-form label {
        font-weight: bold;
        color: #242424;
        text-align: right;
        display: block;
      }

      #gallery-form input,
      #gallery-form textarea {
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-family: inherit;
        width: 100%;
        text-align: right;
      }

      .custom-file-input {
        position: relative;
        overflow: hidden;
        display: inline-block;
        width: 100%;
      }

      .custom-file-input input[type="file"] {
        position: absolute;
        left: 0;
        top: 0;
        opacity: 0;
        width: 100%;
        height: 100%;
        cursor: pointer;
      }

      .custom-file-input-label {
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #1f8fff;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        transition: background-color 0.3s;
        text-align: center;
        gap: 8px;
      }

      .custom-file-input-label:hover {
        background-color: #46c0fd;
      }

      .file-icon {
        width: 20px;
        height: 20px;
        display: none;
      }

      #gallery-form button {
        background-color: #1f8fff;
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        transition: background-color 0.3s;
        margin-top: 10px;
      }

      #gallery-form button:hover {
        background-color: #46c0fd;
      }

      .hidden {
        display: none;
      }

      #download-btn {
        background-color: #01ff62;
        color: #333;
        border: none;
        padding: 12px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 20px;
        font-weight: bold;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        transition: all 0.3s;
      }

      #download-btn:hover {
        background-color: #00e055;
        transform: translateY(-2px);
      }

      .image-input {
        margin-bottom: 15px;
        padding: 15px;
        background-color: rgba(255, 255, 255, 0.7);
        border-radius: 8px;
        text-align: right;
      }

      .preview-image {
        max-width: 100px;
        max-height: 100px;
        border-radius: 5px;
        border: 2px solid #8a5a00;
        display: block;
        margin-top: 10px;
      }

      .background-preview {
        width: 100%;
        height: 100px;
        border-radius: 5px;
        margin-top: 10px;
        border: 1px solid #ccc;
        background-size: contain;
        background-position: center;
        background-repeat: no-repeat;
      }

      #gallery-preview {
        max-width: 100%;
        overflow-y: auto;
        padding: 10px;
      }

      #preview-content {
        width: 1000px;
        max-width: 100%;
        margin: 0 auto;
      }

      .preview-container {
        max-height: 80vh;
        overflow-y: auto;
        padding: 10px;
        border-radius: 10px;
      }

      @media (max-width: 768px) {
        #preview-content {
          width: 100%;
        }

        .preview-container {
          padding: 5px;
        }
      }
    </style>
  </head>
  <body>
    <div id="gallery-form">
      <h1>יצירת גלריה</h1>

      <label for="gallery-title">כותרת הגלריה:</label>
      <input
        type="text"
        id="gallery-title"
        placeholder="לדוגמה: גלריה משפחתית"
        value="גלריה שלי"
      />

      <label for="gallery-background">רקע הגלריה:</label>
      <div class="custom-file-input">
        <input type="file" id="gallery-background" accept="image/*" />
        <label for="gallery-background" class="custom-file-input-label">
          <img
            id="background-icon"
            class="file-icon"
            src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTggMTcuMmw0LTQgNC00IDEuNCAxLjQtNC40IDQuNC00LjQtNC40TDEyIDguOGwtNCA0eiIgZmlsbD0id2hpdGUiLz48L3N2Zz4="
            alt="icon"
          />
          בחר רקע גלריה
        </label>
      </div>
      <div id="background-preview" class="background-preview"></div>

      <div id="image-inputs">
        <!-- קלטים לתמונות יתווספו כאן -->
      </div>

      <button type="button" id="add-image-btn">הוסף תמונה</button>
      <button type="button" id="generate-btn">צור גלריה</button>
    </div>

    <div id="gallery-preview" class="hidden">
      <button
        id="back-btn"
        style="background-color: #8a5a00; color: white; margin-bottom: 20px"
      >
        חזור לעריכה
      </button>
      <div class="preview-container">
        <div id="preview-content"></div>
      </div>
      <button id="download-btn">הורד קובץ HTML</button>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const imageInputs = document.getElementById("image-inputs");
        const addImageBtn = document.getElementById("add-image-btn");
        const generateBtn = document.getElementById("generate-btn");
        const downloadBtn = document.getElementById("download-btn");
        const backBtn = document.getElementById("back-btn");
        const galleryForm = document.getElementById("gallery-form");
        const galleryPreview = document.getElementById("gallery-preview");
        const previewContent = document.getElementById("preview-content");
        const backgroundInput = document.getElementById("gallery-background");
        const backgroundPreview = document.getElementById("background-preview");
        const backgroundIcon = document.getElementById("background-icon");

        let imageCount = 0;
        const maxImages = 10;
        let selectedBackground = null;

        // אתחול עם 2 קלטים לתמונות
        addImageInput();
        addImageInput();

        // מאזין לבחירת רקע
        backgroundInput.addEventListener("change", function (e) {
          const file = e.target.files[0];
          if (!file) return;

          const reader = new FileReader();
          reader.onload = function (event) {
            backgroundPreview.style.backgroundImage = `url('${event.target.result}')`;
            selectedBackground = event.target.result;
            backgroundIcon.style.display = "inline";
          };
          reader.onerror = function () {
            alert("שגיאה בטעינת הרקע. נסה קובץ אחר.");
          };
          reader.readAsDataURL(file);
        });

        addImageBtn.addEventListener("click", addImageInput);
        generateBtn.addEventListener("click", generateGallery);
        downloadBtn.addEventListener("click", downloadHTML);
        backBtn.addEventListener("click", goBackToEdit);

        function addImageInput() {
          if (imageCount >= maxImages) {
            alert(`ניתן להוסיף עד ${maxImages} תמונות בגלריה זו.`);
            return;
          }

          imageCount++;

          const div = document.createElement("div");
          div.className = "image-input";
          div.id = `image-input-${imageCount}`;

          div.innerHTML = `
            <label for="image-title-${imageCount}">כותרת לתמונה ${imageCount}:</label>
            <input type="text" id="image-title-${imageCount}" placeholder="לדוגמה: משפחה בחופשה">

            <label for="image-file-${imageCount}">תמונה ${imageCount}:</label>
            <div class="custom-file-input">
              <input type="file" id="image-file-${imageCount}" accept="image/*">
              <label for="image-file-${imageCount}" class="custom-file-input-label">
                <img id="file-icon-${imageCount}" class="file-icon" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTggMTcuMmw0LTQgNC00IDEuNCAxLjQtNC40IDQuNC00LjQtNC40TDEyIDguOGwtNCA0eiIgZmlsbD0id2hpdGUiLz48L3N2Zz4=" alt="icon">
                בחר קובץ
              </label>
            </div>

            <div id="image-preview-container-${imageCount}" class="image-preview-container"></div>
          `;

          imageInputs.appendChild(div);

          // מאזין לאירוע שינוי לתצוגה מקדימה
          document
            .getElementById(`image-file-${imageCount}`)
            .addEventListener("change", function (e) {
              const previewContainer = document.getElementById(
                `image-preview-container-${imageCount}`
              );
              const fileIcon = document.getElementById(
                `file-icon-${imageCount}`
              );

              if (!e.target.files || !e.target.files[0]) {
                previewContainer.innerHTML = "";
                fileIcon.style.display = "none";
                return;
              }

              const reader = new FileReader();
              reader.onload = function (event) {
                const img = document.createElement("img");
                img.src = event.target.result;
                img.className = "preview-image";
                previewContainer.innerHTML = "";
                previewContainer.appendChild(img);
                fileIcon.style.display = "inline";
              };
              reader.onerror = function () {
                alert("שגיאה בטעינת התמונה. נסה קובץ אחר.");
                previewContainer.innerHTML = "";
                fileIcon.style.display = "none";
              };
              reader.readAsDataURL(e.target.files[0]);
            });
        }

        function generateGallery() {
          const title = document.getElementById("gallery-title").value.trim();
          if (!title) {
            alert("אנא הזן כותרת לגלריה");
            return;
          }

          const imagesData = [];
          let hasErrors = false;

          for (let i = 1; i <= imageCount; i++) {
            const imageTitle = document
              .getElementById(`image-title-${i}`)
              .value.trim();
            const imageFileInput = document.getElementById(`image-file-${i}`);

            if (
              !imageTitle ||
              !imageFileInput.files ||
              !imageFileInput.files[0]
            ) {
              alert(`אנא מלא את כל השדות עבור תמונה ${i}`);
              hasErrors = true;
              document.getElementById(`image-input-${i}`).scrollIntoView({
                behavior: "smooth",
                block: "center",
              });
              break;
            }

            imagesData.push({
              title: imageTitle,
              file: imageFileInput.files[0],
            });
          }

          if (hasErrors || imagesData.length === 0) return;

          createPreview(title, imagesData);
        }

        function createPreview(title, imagesData) {
          previewContent.innerHTML = `
    <div class="container">
      <h1>${title}</h1>
    </div>
    <div class="panels-container" id="preview-panels"></div>
    <style>
      * {
        box-sizing: border-box;
      }

      body.preview-body {
        font-family: "Rubik", sans-serif;
        background: ${
          selectedBackground
            ? `url('${selectedBackground}')`
            : "linear-gradient(135deg, #b37a00 0%, #8a5a00 100%)"
        };
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        padding: 20px;
        touch-action: manipulation;
      }

      .container {
        display: flex;
        width: 100%;
        max-width: 1000px;
        padding: 10px 0;
        gap: 10px;
        margin: 0 auto;
      }

      .panels-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        width: 100%;
        max-width: 1000px;
        gap: 10px;
      }

      h1 {
        font-size: 42px;
        color: #01ff62;
        text-shadow: 0 6px 4px rgba(0, 0, 0, 0.8);
        text-align: center;
        margin: 20px 0;
      }

      .panel {
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        height: 80vh;
        border-radius: 20px;
        color: #01ff62;
        cursor: pointer;
        flex: 0.5;
        position: relative;
        transition: all 700ms cubic-bezier(0.25, 0.46, 0.45, 0.94);
        -webkit-tap-highlight-color: transparent;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        overflow: hidden;
      }

      .panel::before {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 40%;
        background: linear-gradient(to top, rgba(0, 0, 0, 0.7) 0%, transparent 100%);
      }

      .panel h3 {
        font-size: 28px;
        position: absolute;
        bottom: 30px;
        left: 30px;
        right: 30px;
        margin: 0;
        opacity: 0;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
        padding: 12px 16px;
        border-radius: 10px;
        text-align: center;
        transition: all 0.3s ease;
      }

      .panel.active {
        flex: 5;
      }

      .panel.active h3 {
        opacity: 1;
        transform: translateY(0);
      }

      .panel:hover {
        transform: translateY(-5px);
      }

      @media (max-width: 768px) {
        .container, .panels-container {
          padding: 10px;
        }
        
        .panels-container {
          display: flex;
          flex-direction: row;
          overflow-x: auto;
          scroll-snap-type: x mandatory;
          -webkit-overflow-scrolling: touch;
          width: 100%;
        }
        
        .panel {
          min-width: 75%;
          height: 350px;
          margin-right: 10px;
          flex: none;
          scroll-snap-align: start;
          opacity: 0.7;
          transition: all 0.3s ease;
        }
        
        .panel.active {
          flex: none;
          min-width: 75%;
          height: 350px;
          opacity: 1;
          transform: scale(1.05);
        }
        
        .panel h3 {
          font-size: 18px;
          bottom: 15px;
          left: 15px;
          right: 15px;
        }
        
        .panel.active h3 {
          opacity: 1;
        }

        h1 {
          font-size: 34px;
          margin: 10px 0;
        }
      }
    </style>
  `;

          const previewPanels = document.getElementById("preview-panels");

          let loadedCount = 0;
          imagesData.forEach((imageData, index) => {
            const reader = new FileReader();
            reader.onload = function (event) {
              const panel = document.createElement("div");
              panel.className = index === 0 ? "panel active" : "panel";
              panel.style.backgroundImage = `url('${event.target.result}')`;

              const titleElement = document.createElement("h3");
              titleElement.textContent = imageData.title;
              panel.appendChild(titleElement);
              previewPanels.appendChild(panel);

              loadedCount++;
              if (loadedCount === imagesData.length) {
                initGalleryPreview();
                galleryForm.classList.add("hidden");
                galleryPreview.classList.remove("hidden");
                document.body.classList.add("preview-body");
              }
            };
            reader.onerror = function () {
              alert(`שגיאה בטעינת תמונה ${index + 1}. נסה קובץ אחר.`);
            };
            reader.readAsDataURL(imageData.file);
          });
        }

        function initGalleryPreview() {
          const panels = document.querySelectorAll(".panel");
          const isMobile = window.innerWidth <= 768;

          // התחל עם התמונה הראשונה פעילה
          if (panels.length > 0) {
            panels[0].classList.add("active");
          }

          panels.forEach((panel) => {
            panel.addEventListener("click", function () {
              removeActiveClasses();
              this.classList.add("active");

              // גלילה לאלמנט הפעיל במובייל
              if (isMobile) {
                this.scrollIntoView({
                  behavior: "smooth",
                  block: "nearest",
                  inline: "center",
                });
              }
            });

            panel.addEventListener("touchend", function (e) {
              removeActiveClasses();
              this.classList.add("active");
            });
          });
        }

        function goBackToEdit() {
          galleryPreview.classList.add("hidden");
          galleryForm.classList.remove("hidden");
          document.body.classList.remove("preview-body");
        }

        function downloadHTML() {
          const title = document.getElementById("gallery-title").value.trim();
          if (!title) {
            alert("אנא הזן כותרת לגלריה לפני ההורדה");
            return;
          }

          const imagesData = [];
          let filesToLoad = 0;

          for (let i = 1; i <= imageCount; i++) {
            const imageTitle = document
              .getElementById(`image-title-${i}`)
              .value.trim();
            const imageFile = document.getElementById(`image-file-${i}`)
              .files[0];

            if (imageTitle && imageFile) {
              filesToLoad++;
              const reader = new FileReader();
              reader.onload = function (event) {
                imagesData.push({
                  title: imageTitle,
                  image: event.target.result,
                });

                if (imagesData.length === filesToLoad) {
                  createHTMLFile(title, imagesData);
                }
              };
              reader.onerror = function () {
                alert(`שגיאה בטעינת תמונה ${i}. נסה קובץ אחר.`);
              };
              reader.readAsDataURL(imageFile);
            }
          }

          if (filesToLoad === 0) {
            alert("אנא הוסף לפחות תמונה אחת לפני ההורדה");
          }
        }

        function createHTMLFile(title, imagesData) {
          let panelsHTML = "";
          imagesData.forEach((image, index) => {
            panelsHTML += `
      <div class="panel ${
        index === 0 ? "active" : ""
      }" style="background-image: url('${image.image}')">
        <h3>${image.title}</h3>
      </div>
    `;
          });

          const htmlContent = `<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>${title}</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: "Rubik", sans-serif;
      background: ${
        selectedBackground
          ? `url('${selectedBackground}')`
          : "linear-gradient(135deg, #b37a00 0%, #8a5a00 100%)"
      };
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      touch-action: manipulation;
    }

    .container {
      display: flex;
      width: 100%;
      max-width: 1000px;
      padding: 10px 0;
      gap: 10px;
      margin: 0 auto;
    }

    .panels-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      width: 100%;
      max-width: 1000px;
      gap: 10px;
    }

    h1 {
      font-size: 42px;
      color: #01ff62;
      text-shadow: 0 6px 4px rgba(0, 0, 0, 0.8);
      text-align: center;
      margin: 20px 0;
            width: 100%;

    }

    .panel {
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      height: 80vh;
      border-radius: 20px;
      color: #01ff62;
      cursor: pointer;
      flex: 0.5;
      position: relative;
      transition: all 700ms cubic-bezier(0.25, 0.46, 0.45, 0.94);
      -webkit-tap-highlight-color: transparent;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      overflow: hidden;
    }

    .panel::before {
      content: "";
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 40%;
      background: linear-gradient(to top, rgba(0, 0, 0, 0.7) 0%, transparent 100%);
    }

    .panel h3 {
      font-size: 28px;
      position: absolute;
      bottom: 30px;
      left: 30px;
      right: 30px;
      margin: 0;
      opacity: 0;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
      padding: 12px 16px;
      border-radius: 10px;
      text-align: center;
      transition: all 0.3s ease;
    }

    .panel.active {
      flex: 5;
    }

    .panel.active h3 {
      opacity: 1;
      transform: translateY(0);
    }

    .panel:hover {
      transform: translateY(-5px);
    }

    @media (max-width: 768px) {
      .container, .panels-container {
        padding: 10px;
      }
      
      .panels-container {
        display: flex;
        flex-direction: row;
        overflow-x: auto;
        scroll-snap-type: x mandatory;
        -webkit-overflow-scrolling: touch;
        width: 100%;
      }
      
      .panel {
        min-width: 100%;
        height: 30px;
        margin-right: 10px;
        flex: none;
        scroll-snap-align: start;
        opacity: 0.7;
        transition: all 0.3s ease;
      }
      
      .panel.active {
        flex: none;
        min-width: 100%;
        height: 350px;
        opacity: 1;
        transform: scale(1.05);
      }
      
      .panel h3 {
        font-size: 18px;
        bottom: 15px;
        left: 15px;
        right: 15px;
      }
      
      .panel.active h3 {
        opacity: 1;
      }

      h1 {
        font-size: 28px;
        margin: 10px 0;
                width: 100%;

      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>${title}</h1>
  </div>

  <div class="panels-container">
    ${panelsHTML}
  </div>
  
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    const panels = document.querySelectorAll(".panel");
    const isMobile = window.innerWidth <= 768;
    
    // Start with first panel active
    if (panels.length > 0) {
      panels[0].classList.add("active");
    }

    function removeActiveClasses() {
      panels.forEach((panel) => {
        panel.classList.remove("active");
      });
    }

    panels.forEach((panel) => {
      panel.addEventListener("click", function() {
        removeActiveClasses();
        this.classList.add("active");
        
        // Scroll to active element on mobile
        if (isMobile) {
          this.scrollIntoView({
            behavior: 'smooth',
            block: 'nearest',
            inline: 'center'
          });
        }
      });

      panel.addEventListener("touchend", function(e) {
        removeActiveClasses();
        this.classList.add("active");
      });
    });

    // Track horizontal scrolling on mobile and update active element
    if (isMobile) {
      const panelsContainer = document.querySelector(".panels-container");
      panelsContainer.addEventListener('scroll', function() {
        const scrollPosition = panelsContainer.scrollLeft;
        let closestPanel = null;
        let minDistance = Infinity;
        
        panels.forEach(panel => {
          const rect = panel.getBoundingClientRect();
          const distance = Math.abs(rect.left - 20);
          
          if (distance < minDistance) {
            minDistance = distance;
            closestPanel = panel;
          }
        });
        
        if (closestPanel) {
          removeActiveClasses();
          closestPanel.classList.add('active');
        }
      });
    }

    // Handle screen orientation change on mobile
    window.addEventListener("orientationchange", function() {
      setTimeout(function() {
        const activePanel = document.querySelector(".panel.active");
        if (activePanel) {
          activePanel.scrollIntoView({
            behavior: 'smooth',
            block: 'nearest',
            inline: 'center'
          });
        }
      }, 300);
    });
  });
  <\/script>
</body>
</html>`;

          const blob = new Blob([htmlContent], { type: "text/html" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = `${title.replace(/\s+/g, "_")}.html`;
          document.body.appendChild(a);
          a.click();
          setTimeout(() => {
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
          }, 100);
        }
      });
    </script>
  </body>
</html>
